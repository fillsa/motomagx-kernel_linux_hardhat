#!/bin/sh

# Copyright (C) 2007 Motorola, Inc.

# Change Log:
# Date         Author          Comment 
# ===========  ==============  ==============================================
# 03/08/2007   Motorola        Changed to interact with clearmake build system
# 03/08/2007   Motorola        Changed to use saved toolprefix


# Generates a small Makefile used in the root of the output
# directory, to allow make to be started from there.
# The Makefile also allow for more convinient build of external modules

# Usage
# $1 - Kernel src directory
# $2 - Output directory
# $3 - version
# $4 - patchlevel


cat << EOF
# Automatically generated by $0: don't edit

include toolprefix.mk

VERSION = $3
PATCHLEVEL = $4

KERNELSRC    := $1
# modified to point to the current directory to support copying the config results
KERNELOUTPUT := \$(shell pwd)

MAKEFLAGS += --no-print-directory

override MAKE := make
.NO_WINK_IN: %

# set JOBS on the command line to send parallel options to gmake (i.e. -j4) 
all:
	env -u MAKECMDGOALS \$(MAKE) \$(JOBS) \$(MAKEARGS) CROSS_COMPILE=\$(TOOLPREFIX) -C \$(KERNELSRC) O=\$(KERNELOUTPUT)

%::
	env -u MAKECMDGOALS \$(MAKE) \$(JOBS) \$(MAKEARGS) CROSS_COMPILE=\$(TOOLPREFIX) -C \$(KERNELSRC) O=\$(KERNELOUTPUT) \$@

EOF

